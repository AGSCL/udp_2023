---
title: "Clase 6"
author: "Andrés González"
date:  "`r withr::with_locale(new =c('LC_TIME' = 'es_ES'), code =format(Sys.time(),'%B %d, %Y'))`"
encoding: utf-8
output:
  xaringan::moon_reader:
    includes:
      after_body: ['mylibs/collapseoutput.js','mylibs/zoom.html','mylibs/hideOutput.js', 'mylibs/manualcollapseinput.html']
    transition: slide
    lib_dir: libs
    css: ['animate.min.css', 'ninjutsu'] # xaringan-themer has something bad '\x93'
    self_contained: true # if true, fonts will be stored locally
    seal: false # show a title slide with YAML information
    nature:
      countdown: 90000 #60 segundos *2
      highlightStyle: github
      highlightLines: true # {{}} o * los pondrá como muy importantes  para destacar: # <<
      slideNumberFormat: '%current%'
      countIncrementalSlides: false
      ratio: '16:9' # alternatives '16:9' or '4:3' or others e.g. 13:9
      navigation:
        scroll: false # disable slide transitions by scrolling
---
class: title-slide, middle, right 

```{css, echo = F}
/* -------------------------------------------------------
 *
 *     !! This file was generated by xaringanthemer !!
 *
 *  Changes made to this file directly will be overwritten
 *  if you used xaringanthemer in your xaringan slides Rmd
 *
 *  Issues or likes?
 *    - https://github.com/gadenbuie/xaringanthemer
 *    - https://www.garrickadenbuie.com
 *
 *  Need help? Try:
 *    - vignette(package = "xaringanthemer")
 *    - ?xaringanthemer::style_xaringan
 *    - xaringan wiki: https://github.com/yihui/xaringan/wiki
 *    - remarkjs wiki: https://github.com/gnab/remark/wiki
 *
 *  Version: 0.4.1
 *
 * ------------------------------------------------------- */
@import url(https://fonts.googleapis.com/css?family=Lato:400,400i&display=swap);
@import url(https://fonts.googleapis.com/css?family=Lato&display=swap);
@import url(https://fonts.googleapis.com/css?family=Lato&display=swap);
@import url(https://fonts.googleapis.com/css?family=Arial+Narrow&display=swap);

:root {
  /* Fonts */
  --text-font-family: Lato;
  --text-font-is-google: 1;
  --text-font-family-fallback: -apple-system, BlinkMacSystemFont, avenir next, avenir, helvetica neue, helvetica, Ubuntu, roboto, noto, segoe ui, arial;
  --text-font-base: sans-serif;
  --header-font-family: Lato;
  --header-font-is-google: 1;
  --header-font-family-fallback: Georgia, serif;
  --code-font-family: Lato;
  --code-font-is-google: 1;
  --base-font-size: 20px;
  --text-font-size: 1rem;
  --code-font-size: 53%;
  --code-inline-font-size: 1em;
  --header-h1-font-size: 2.75rem;
  --header-h2-font-size: 2.25rem;
  --header-h3-font-size: 1.75rem;

  /* Colors */
  --text-color: #333333;
  --header-color: #DD3333;
  --background-color: #FFFFFF;
  --link-color: #DD3333;
  --text-bold-color: #FF5252;
  --code-highlight-color: rgba(255,255,0,0.5);
  --inverse-text-color: #FFFFFF;
  --inverse-background-color: #DD3333;
  --inverse-header-color: #FFFFFF;
  --inverse-link-color: #DD3333;
  --title-slide-background-color: #FFFFFF;
  --title-slide-text-color: #DD3333;
  --header-background-color: #DD3333;
  --header-background-text-color: #FFFFFF;
  --primary: #FFFFFF;
  --secondary: #DD3333;
}

html {
  font-size: var(--base-font-size);
}

body {
  font-family: var(--text-font-family), var(--text-font-family-fallback), var(--text-font-base);
  font-weight: 400;
  color: var(--text-color);
}
h1, h2, h3 {
  font-family: var(--header-font-family), var(--header-font-family-fallback);
  font-weight: 600;
  color: var(--header-color);
}
.remark-slide-content {
  background-color: var(--background-color);
  font-size: 1rem;
  padding: 0.4em 2.4em 0.4em 2.4em;
  width: 100%;
  height: 100%;
}
.remark-slide-content h1 {
  font-size: var(--header-h1-font-size);
}
.remark-slide-content h2 {
  font-size: var(--header-h2-font-size);
}
.remark-slide-content h3 {
  font-size: var(--header-h3-font-size);
}
.remark-code, .remark-inline-code {
  font-family: var(--code-font-family), Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace;
}
.remark-code {
  font-size: var(--code-font-size);
}
.remark-inline-code {
  font-size: var(--code-inline-font-size);
  color: #DD3333;
}
.remark-slide-number {
  color: #333333;
  opacity: 1;
  font-size: 0.9rem;
}
strong {
  font-weight: bold;
  color: var(--text-bold-color);
}
a, a > code {
  color: var(--link-color);
  text-decoration: none;
}
.footnote {
  position: absolute;
  bottom: 60px;
  padding-right: 4em;
  font-size: 0.9em;
}
.remark-code-line-highlighted {
  background-color: var(--code-highlight-color);
}
.inverse {
  background-color: var(--inverse-background-color);
  color: var(--inverse-text-color);
  
}
.inverse h1, .inverse h2, .inverse h3 {
  color: var(--inverse-header-color);
}
.inverse a, .inverse a > code {
  color: var(--inverse-link-color);
}
.title-slide, .title-slide h1, .title-slide h2, .title-slide h3 {
  color: var(--title-slide-text-color);
}
.title-slide {
  background-color: var(--title-slide-background-color);
}
.title-slide .remark-slide-number {
  display: none;
}
/* Two-column layout */
.left-column {
  width: 20%;
  height: 92%;
  float: left;
}
.left-column h2, .left-column h3 {
  color: #DD333399;
}
.left-column h2:last-of-type, .left-column h3:last-child {
  color: #DD3333;
}
.right-column {
  width: 75%;
  float: right;
  padding-top: 1em;
}
.pull-left {
  float: left;
  width: 47%;
}
.pull-right {
  float: right;
  width: 47%;
}
.pull-right + * {
  clear: both;
}
img, video, iframe {
  max-width: 100%;
}
blockquote {
  border-left: solid 5px #DD333380;
  padding-left: 1em;
}
.remark-slide table {
  margin: auto;
  border-top: 1px solid #666;
  border-bottom: 1px solid #666;
}
.remark-slide table thead th {
  border-bottom: 1px solid #ddd;
}
th, td {
  padding: 5px;
}
.remark-slide thead, .remark-slide tfoot, .remark-slide tr:nth-child(even) {
  background: #FFFFFF;
}
table.dataTable tbody {
  background-color: var(--background-color);
  color: var(--text-color);
}
table.dataTable.display tbody tr.odd {
  background-color: var(--background-color);
}
table.dataTable.display tbody tr.even {
  background-color: #FFFFFF;
}
table.dataTable.hover tbody tr:hover, table.dataTable.display tbody tr:hover {
  background-color: rgba(255, 255, 255, 0.5);
}
.dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter, .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_processing, .dataTables_wrapper .dataTables_paginate {
  color: var(--text-color);
}
.dataTables_wrapper .dataTables_paginate .paginate_button {
  color: var(--text-color) !important;
}

/* Horizontal alignment of code blocks */
.remark-slide-content.left pre,
.remark-slide-content.center pre,
.remark-slide-content.right pre {
  text-align: start;
  width: max-content;
  max-width: 100%;
}
.remark-slide-content.left pre,
.remark-slide-content.right pre {
  min-width: 50%;
  min-width: min(40ch, 100%);
}
.remark-slide-content.center pre {
  min-width: 66%;
  min-width: min(50ch, 100%);
}
.remark-slide-content.left pre {
  margin-left: unset;
  margin-right: auto;
}
.remark-slide-content.center pre {
  margin-left: auto;
  margin-right: auto;
}
.remark-slide-content.right pre {
  margin-left: auto;
  margin-right: unset;
}

/* Slide Header Background for h1 elements */
.remark-slide-content.header_background > h1 {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  background: var(--header-background-color);
  color: var(--header-background-text-color);
  padding: 2rem 2.4em 1.5rem 2.4em;
  margin-top: 0;
  box-sizing: border-box;
}
.remark-slide-content.header_background {
  padding-top: 7rem;
}

@page { margin: 0; }
@media print {
  .remark-slide-scaler {
    width: 100% !important;
    height: 100% !important;
    transform: scale(1) !important;
    top: 0 !important;
    left: 0 !important;
  }
}

.primary {
  color: var(--primary);
}
.bg-primary {
  background-color: var(--primary);
}
.secondary {
  color: var(--secondary);
}
.bg-secondary {
  background-color: var(--secondary);
}

/* Extra CSS */
.remark-slide-scaler {
  overflow-y: auto;
}
.gray {
  color: #aaaaaa;
}
.black {
  color: #bc7777;
}
.darkgreen {
  color: #45503B;
}
.darkred {
  color: #591F0A;
}
.small {
  font-size: 90%;
}
.pull_c {
  float: center;
  width: 30%;
  height: 50%;
  padding-left: 40%;
}
.pull_c_title {
  height: 90%;
}
.pull_l_70 {
  float: left;
  width: 72%;
  font-size: 90%;
}
.pull_r_30 {
  float: right;
  width: 23%;
  font-size: 90%;
}
.pull_left {
  float: left;
  width: 47%;
  height: 100%;
  padding-right: 2%;
}
.pull_right {
  float: right;
  width: 47%;
  height: 100%;
  padding-left: 2%;
}
.small_left {
  float: left;
  width: 47%;
  height: 50%;
  padding-right: 2%;
}
.small_right {
  float: right;
  width: 47%;
  height: 50%;
  padding-left: 2%;
}
.left_code {
  float: left;
  width: 47%;
  height: 100%;
  padding-right: 2%;
  font: Roboto;
}
.code_out {
  float: right;
  width: 47%;
  height: 100%;
  padding-left: 2%;
  font: Roboto;
}
.text_180 {
  font-size: 180%;
}
.text_170 {
  font-size: 170%;
}
.text_160 {
  font-size: 160%;
}
.text_150 {
  font-size: 150%;
}
.text_140 {
  font-size: 140%;
}
.text_130 {
  font-size: 130%;
}
.text_120 {
  font-size: 120%;
}
.text_110 {
  font-size: 110%;
}
.text_110 {
  font-size: 110%;
}
.text_100 {
  font-size: 100%;
}
.code_10 {
  code-inline-font-size: 60%;
  overflow-y: scroll !important;
  overflow-x: scroll !important;
  max-height: 5vh !important;
  line-height: 0.75em;
}
.code_10_pre {
  code-inline-font-size: 60%;
  overflow-y: scroll !important;
  overflow-x: scroll !important;
  max-height: 15vh !important;
  line-height: 0.75em;
  min-height: 0.5em;
}
.code_15 {
  code-inline-font-size: 15%;
  overflow-y: scroll !important;
  overflow-x: scroll !important;
  max-height: 10vh !important;
}
.text_90 {
  font-size: 90%;
}
.text_80 {
  font-size: 80%;
}
.text_70 {
  font-size: 70%;
}
.text_65 {
  font-size: 65%;
}
.text_60 {
  font-size: 60%;
}
.text_50 {
  font-size: 50%;
}
.text_40 {
  font-size: 40%;
}
.text_30 {
  font-size: 30%;
}
.text_20 {
  font-size: 20%;
}
.line_space_15 {
  line-height: 1.5em;;
}
.line_space_13 {
  line-height: 1.3em;;
}
.line_space_11 {
  line-height: 1.1em;;
}
.line_space_15 {
  line-height: 1.5em;;
}
.line_space_09 {
  line-height: 0.9em;;
}
.line_space_07 {
  line-height: 0.7em;;
}
.line_space_05 {
  line-height: 0.5em;;
}
.largest {
  font-size: 2.488em;;
}
.larger {
  font-size: 2.074em;;
}
.large {
  font-size: 1.44em;;
}
.small {
  font-size: 0.833em;;
}
.smaller {
  font-size: 0.694em;;
}
.smallest {
  font-size: 0.579em;;
}
.limity150 {
  max-height: 150px;;
  overflow-y: auto;;
}
.tiny_text {
  font-size: 70%;
}
.large_text {
  font-size: 150%;
}
.slide_blue {
  background-color: #FEDA3F;
  color: #3C3C3B;
}
.center_image {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
.center_left_img {
  top: 50%;
  left: 35%;
}
.center_left_image {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 35%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
.center_down_image {
  margin: 0;
  position: absolute;
  top: 90%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
.center_top_image {
  margin: 0;
  position: absolute;
  top: 10%; /* Adjust to place the image at the top */
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
slides > slide {
  overflow-x: auto !important;
  overflow-y: auto !important;
}
.superbigimage {
  white-space: nowrap;
  overflow-y: scroll;
}
```

```{r setup_theme0, include = FALSE}
rm(list=ls());gc()

# # Read in file with correct encoding
# contents <- readLines("xaringan-themer.css", encoding = "Windows-1252")
# 
# # Replace offending character
# clean_contents <- gsub("\x93", "", contents)
# 
# # Write cleaned contents back out with desired encoding
# writeLines(clean_contents, "xaringan-themer3.css", useBytes = TRUE)

#if(!grepl("4.1.2",R.version.string)){stop("Different version (must be 4.1.2)")}
pacman::p_unlock(lib.loc = .libPaths()) #para no tener problemas reinstalando paquetes

if(!require(devtools)){install.packages("devtools", type = "win.binary", dependencies=T)}

options(servr.daemon = TRUE)
```

```{cat, engine.opts=list(file = "mylibs/zoom.html"), include=F}
<script src="https://lab.hakim.se/zoom-js/js/zoom.js" type="text/javascript"></script>
<script type="text/javascript">
	slideshow.on( "beforeHideSlide", function( slide ) {
		zoom.out();
	} );
	slideshow.on( "afterShowSlide", function( slide ) {
		document.querySelector( ".remark-visible" ).addEventListener( "dblclick", function( event ) {
			event.preventDefault();
			zoom.to( {element: event.target} );
		} );
	} );
</script>
```

```{r setup, include = FALSE}
local({r <- getOption("repos")
       r["CRAN"] <- "https://cran.dcc.uchile.cl/"
       options(repos=r)
})

if(!require(pacman)){install.packages("pacman")}

if(!require(rcanvas)){devtools::install_github("daranzolin/rcanvas")}

pacman::p_load(devtools, here, showtext, ggpattern, RefManageR, pagedown, magick, bibtex, DiagrammeR, xaringan, xaringanExtra, xaringanthemer, fontawesome, widgetframe, datapasta, tidyverse, psych, tidyverse, cowplot, pdftools, showtext, compareGroups, ggiraph, sf, distill, data.tree,
               widgetframe, install= T)

if(!require(xaringanBuilder)){devtools::install_github("jhelvy/xaringanBuilder",upgrade = "never")}
if(!require(icons)){remotes::install_github("mitchelloharawild/icons",upgrade = "never")}

test_fontawesome<- function(x="github"){
tryCatch({
  invisible(fontawesome::fa(name = x))
  return(message("fontawesome installed"))
},
# ... but if an error occurs, tell me what happened: 
error=function(error_message) {
  message("Installing fontawesome")
  icons::download_fontawesome()  
})
}

vec_col<-c("#660600","#6F3930","#745248","#786B60","#E6E6E6","#738FBC","#003891","#3C5279","#786B60","#B48448","#EF9D2F","#D99155","#E3D1C2","#E0BC9E","#ABB0BF","#835F69","#5A0D13")
plot_prueba<-barplot(1:length(vec_col), col=vec_col)

#https://coolors.co/21177a-fe4a17-788aa3-45503b
xaringanthemer::style_duo( #ABB0BF
  primary_color = "#FFFFFF",  #555555 gris oscuro
  secondary_color = "#DD3333",#"#FF5252"))) 
  text_color = "#333333", #bc7777
  text_bold_color = "#FF5252",
  #base_color = '#bc7777',
  background_position = 'center',
  header_font_google = google_font("Lato"),#Josefin Sans
  text_font_google   = google_font("Lato", "400", "400i"),
  code_font_google   = google_font("Lato"),
  code_font_size = '53%', #sirve
  padding = "0.4em 2.4em 0.4em 2.4em",
  extra_fonts = list(google_font("Arial Narrow")),
 # title_slide_background_image = "./_figs/bg_portada.svg",
#  title_slide_background_size = "cover",
 # background_image = "./_figs/bg.svg",
  background_size = "cover",
  extra_css =
  list(
  ".remark-slide-scaler" = list("overflow-y" = "auto"), # para no tener limites de extensión
 # ".remark-slide-number" = list("display" = "none"), #oculta el reloj también
 # "pre"= list("line-height"= "0.2em"),
  ".gray"   = list(color = "#aaaaaa"),
  ".black"   = list(color = "#bc7777"),
  ".darkgreen"   = list(color = "#45503B"),
  ".darkred"   = list(color = "#591F0A"),
  ".small" = list("font-size" = "90%"),
  ".pull_c" = list("float" = "center","width" = "30%", "height" = "50%", "padding-left" = "40%"),
  ".pull_c_title" = list("height" = "90%"),
  ".pull_l_70" = list("float"= "left","width"= "72%", "font-size"= "90%"),
  ".pull_r_30" = list("float"= "right","width"= "23%", "font-size"= "90%"),
  ".pull_left"  = list("float"= "left","width"= "47%", "height"= "100%", "padding-right"= "2%"),
  ".pull_right" = list("float"= "right","width"= "47%", "height"= "100%", "padding-left"= "2%"),
  ".small_left"  = list("float"= "left", "width"= "47%", "height"= "50%", "padding-right"= "2%"),
  ".small_right" = list("float"= "right","width"= "47%", "height"= "50%", "padding-left"= "2%"),
  ".left_code" = list("float"="left","width"="47%","height"="100%","padding-right"="2%",    "font"="Roboto"),
  ".code_out"  = list("float"="right","width"="47%","height"="100%","padding-left"="2%",    "font"="Roboto"),
  ".text_180" = list("font-size" = "180%"),
  ".text_170" = list("font-size" = "170%"),
  ".text_160" = list("font-size" = "160%"),    
  ".text_150" = list("font-size" = "150%"),
  ".text_140" = list("font-size" = "140%"),  
  ".text_130" = list("font-size" = "130%"),
  ".text_120" = list("font-size" = "120%"),
  ".text_110" = list("font-size" = "110%"),
  ".text_110" = list("font-size" = "110%"),
  ".text_100" = list("font-size" = "100%"),
  ".code_10" = list("code-inline-font-size"= "60%",
                    "overflow-y" = "scroll !important",
                    "overflow-x" = "scroll !important",
                    "max-height" = "5vh !important",
                    "line-height"= "0.75em"),
   ".code_10_pre" = list("code-inline-font-size"= "60%",
                    "overflow-y" = "scroll !important",
                    "overflow-x" = "scroll !important",
                    "max-height" = "15vh !important",
                    "line-height"= "0.75em",
                    "min-height"="0.5em"
                    ),
  ".code_15" = list("code-inline-font-size"= "15%",
                    "overflow-y" = "scroll !important",
                    "overflow-x" = "scroll !important",
                    "max-height" = "10vh !important"),
  ".text_90" = list("font-size" = "90%"),
  ".text_80" = list("font-size" = "80%"),
  ".text_70" = list("font-size" = "70%"),
  ".text_65" = list("font-size" = "65%"),
  ".text_60" = list("font-size" = "60%"),
  ".text_50" = list("font-size" = "50%"),
  ".text_40" = list("font-size" = "40%"),
  ".text_30" = list("font-size" = "30%"),
  ".text_20" = list("font-size" = "20%"),
  ".line_space_15" = list("line-height" = "1.5em;"),
  ".line_space_13" = list("line-height" = "1.3em;"),
  ".line_space_11" = list("line-height" = "1.1em;"),
  ".line_space_15" = list("line-height" = "1.5em;"),
  ".line_space_09" = list("line-height" = "0.9em;"),
  ".line_space_07" = list("line-height" = "0.7em;"),
  ".line_space_05" = list("line-height" = "0.5em;"),
  ".largest" =  list("font-size" = "2.488em;"),
  ".larger" =  list("font-size" = "2.074em;"),
  ".large" =  list("font-size" = "1.44em;"),
  ".small" =  list("font-size" = "0.833em;"),
  ".smaller" =  list("font-size" = "0.694em;"),
  ".smallest" =  list("font-size" = "0.579em;"),
  ".limity150" = list("max-height" = "150px;",
                     "overflow-y" = "auto;"
      ),
    ".tiny_text" = list(
      "font-size"= "70%"
      ),
    ".large_text" = list(
      "font-size"= "150%"
      ),
    ".slide_blue" = list(
      "background-color" = "#FEDA3F",
      "color" = "#3C3C3B"
      ),
  ".center_image" = list(
    margin  = "0",
    position = "absolute",
    top      = "50%",
    left     = "50%",
    '-ms-transform' = "translate(-50%, -50%)",
    transform = "translate(-50%, -50%)"
    ),
    ".center_down_image" = list(
    margin  = "0",
    position = "absolute",
    top      = "90%",
    left     = "50%",
    '-ms-transform' = "translate(-50%, -50%)",
    transform = "translate(-50%, -50%)"
    ),
    "slides > slide" = list(
    "overflow-x"  = "auto !important",
    "overflow-y" = "auto !important"
    ),
 #   "pre" = list(
#    "white-space"  = "pre !important",
#    "overflow-y" = "scroll !important",
#    "max-height" = "40vh !important",
#    "font-size" = "0.8em"
#    ),
    ".superbigimage" = list(
    "white-space"  = "nowrap",
    "overflow-y" = "scroll"
    )
  )
)

options(htmltools.preserve.raw = FALSE)


#knitr::opts_chunk$set(comment = NA) # lo saqué pa probar por si
knitr::opts_chunk$set(dpi=720)
#options(htmltools.preserve.raw = FALSE)#A recent update to rmarkdown (in version 2.6) changed how HTML widgets are included in the output file to use pandoc's raw HTML blocks. Unfortunately, this feature isn't compatible with the JavaScript markdown library used by xaringan. You can disable this feature and resolve the issue with htmlwidgets in xaringan slides by setting
#https://stackoverflow.com/questions/65766516/xaringan-presentation-not-displaying-html-widgets-even-when-knitting-provided-t/65768952#65768952


xaringanExtra::use_progress_bar(color = "#12636B", location = "top")#, height = "550px")
xaringanExtra::use_animate_css()
xaringanExtra::use_scribble() #son los lapices
xaringanExtra::use_tile_view()
xaringanExtra::use_panelset()
xaringanExtra::use_editable(expires = 1)
xaringanExtra::use_fit_screen()

#https://gist.github.com/gadenbuie/61b27108ceec6c7a55cd9966609128d7

# padding-top: 0.4em;
# padding-right: 2.4em;
# padding-bottom: 0.4em;
# padding-left: 2.4em;
invisible("https://www.youtube.com/watch?v=M3skTMQbCD0")
invisible("https://zane.lol/slides/adirondack/#39")
#https://titanwolf.org/Network/Articles/Article?AID=3896fe2c-1b3b-4ebd-9906-1f9ed1675b35#gsc.tab=0
#https://annakrystalli.me/talks/xaringan/xaringan.html#55
#https://bookdown.org/yihui/rmarkdown/some-tips.html
#https://arm.rbind.io/slides/xaringan.html#90
#https://stackoverflow.com/questions/62069400/font-size-of-figure-in-xaringan-slide-too-small
#https://irene.vrbik.ok.ubc.ca/blog/2021-07-14-xaringan-slides/

#https://evamaerey.github.io/doublecrochet/
#devtools::install_github("paulhendricks/anonymizer")
check_code <- function(expr, available){
  if(available){
    eval(parse(text = expr))
  } else {
    expr
  }
}
path2<-dirname(rstudioapi::getSourceEditorContext()$path)
#knitr::opts_chunk$set(message = FALSE,warning = FALSE, error = FALSE)

```

<br> 
 
.line_space_15[ 
## .text_80[Estadística Aplicada y <br> Procesamiento de Datos con R]
]

<br>

.line_space_11[
    
<br>

.text_70[[Código en: `r fontawesome::fa(name = "github")`](https://github.com/AGSCL/Curso_UDP)]

.text_110[Clase 6. Aplicaciones]

]


.bg-text[


`r withr::with_locale(new = c('LC_TIME' = 'es_ES'), code =format(Sys.time(),'%d de %B, %Y'))`



.text_100[Andrés González Santa Cruz]

.text_65[andres.gonzalezs@mail.udp.cl] [`r fontawesome::fa(name = "github")`](https://github.com/AGSCL) [`r fontawesome::fa(name = "orcid", fill="green")`](https://orcid.org/0000-0002-5166-9121)
]

.text_100[José Ruiz-Tagle Maturana]

.text_65[jose.ruiztagle@mail.udp.cl] [`r fontawesome::fa(name = "orcid", fill="green")`](https://orcid.org/0000-0002-4866-5701)

<br>
  
```{r echo=FALSE, out.width = '15%'}
knitr::include_graphics('./_style/cropped-logotipo_fsch.png')
```

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_


---
layout: true
class: animated, fadeIn
---
## Introducción

- **Datos bivariados** : "Son los valores de 2 variables diferentes que se obtienen del mismo elemento poblacional" (Johnson & Kuby, 2008, p. 146)

- Veremos algunos ejemplos aplicados de lo que quieren ver: estadística bivariada

.details-code[
```{r echo=T, error=T, fig.align="center", message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
data("ChickWeight")
data("USArrests")
```
]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
  
  - Bivariate analyses are conducted to determine whether a statistical association exists between two variables, the degree of association if one does exist, and whether one variable may be predicted from another. (https://doi.org/10.1007/978-94-007-0753-5_222)

---
## Chi-cuadrado

- Supongamos que una tasa alarmante de violaciones en USA se definió en 11 por 100,000 habitantes.

- ¿Existe una asociación entre una alta tasa de asesinatos y violaciones?

.left-column[

$$x^2 = \sum \frac{(O-E)^2}{E}$$

$$gl = (r- 1) (e - 1)$$

.small[
Sea:
- O= frecuencia observada de una casilla, E= Frecuencia esperada de una casilla
- gl= r= número de filas en la tabla cruzada / c= número de columnas en la tabla cruzada
]

.details-code[
```{r echo=T, error=T, fig.align="center", message=FALSE, warning=FALSE}
USArrests_rec<-
USArrests %>% 
  dplyr::mutate(Murder_hi=ifelse(Murder>=7.25,"hi murder","lo murder")) %>% 
  dplyr::mutate(Rape_hi=ifelse(Rape>=18,"hi rape","lo rape"))
```
]

]

.right-column[

.details-code[

```{r echo=T, fig.align='center', fig.retina=1, message=FALSE, warning=FALSE, out.width='50%'}
#importamos una función en el que tome el ancho como la proporción de la categoría x (en este caso, Asesinatos)
makeplot_mosaic <- function(data, x, y, ...){
  xvar <- deparse(substitute(x))
  yvar <- deparse(substitute(y))
  mydata <- data[c(xvar, yvar)];
  mytable <- table(mydata);
  widths <- c(0, cumsum(apply(mytable, 1, sum)));
  heights <- apply(mytable, 1, function(x){c(0, cumsum(x/sum(x)))});

  alldata <- data.frame();
  allnames <- data.frame();
  for(i in 1:nrow(mytable)){
    for(j in 1:ncol(mytable)){
      alldata <- rbind(alldata, c(widths[i], widths[i+1], heights[j, i], heights[j+1, i]));
    }
  }
  colnames(alldata) <- c("xmin", "xmax", "ymin", "ymax")

  alldata[[xvar]] <- rep(dimnames(mytable)[[1]],rep(ncol(mytable), nrow(mytable)));
  alldata[[yvar]] <- rep(dimnames(mytable)[[2]],nrow(mytable));

  ggplot(alldata, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax)) + 
    geom_rect(color="black", aes_string(fill=yvar)) +
    xlab(paste(xvar, "(Recuento)")) + ylab(paste(yvar, "(Proporción)"));
}

makeplot_mosaic(USArrests_rec, 
                Murder_hi, Rape_hi)+
#######  Añadimos etiquetas  las dimensiones
    xlab("Alto arresto por asesinato")+ ylab("Alto arresto por violación")+
#######  La escala Y la cambiamos a porcentajes
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
#######  Definimos el formato de la figura con base de las letras en tamaño 12
    theme_minimal(base_size = 12)+
  theme(legend.position="none")+
      scale_fill_manual(values = c("#333333", "#DD3333"))
```

]

.details-code[
```{r echo=T, error=T, fig.align="center", message=FALSE, warning=FALSE}
chisq.test(table(USArrests_rec$Murder_hi, USArrests_rec$Rape_hi))
```
]

.details-code[
```{r echo=T, error=T, fig.align="center", message=FALSE, warning=FALSE}
chisq.test(table(USArrests_rec$Murder_hi, USArrests_rec$Rape_hi),
           simulate.p.value =T, B=2e4)
```
]
]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

- no paramétrica
- mínimo requerido de 5 casos
- Se recomienda que el tamaño global de la muestra debe ser igual al número de casillas multiplicado por 12
- Una tercera alternativa consiste en llevar a cabo una corrección en el cálculo de la chi cuadrada, restando 0.5 al calcular cada una de las diferencias entre las frecuencias observadas y las esperadas. Esto se denomina corrección de Yates por continuidad; ésta realiza un ajuste como resultado de la inconsistencia de los tamaños de las casillas. Una cuarta alternativa consiste en utilizar otra prueba estadística denominada prueba exacta de Fisher (Blalock, 1979, 292). Ésta resulta de utilidad en situaciones en las que se presentan muchas frecuencias menores de 5, pero ninguna de las cuales puede eliminarse o combinarse de manera justificada (Ritchey, 2008, cap. 13)
- Si tus datos fallan en no contar con más de 5 datos por celda, puede colasarse las categorías para incrementar la frecuencia esperada. Si no es posible, usar Fisher o

- **¿Dice algo de la magnitud de la asociación?, no**

- Sólo dice si existe o no.

---
## Odds ratio

.details-code[
```{r}
df<-
matrix(c(c("a","b"),c("c","d")),ncol=2, byrow=F) %>% 
  data.frame() 

# nombrar columnas y filas
colnames(df) <- c("Evento Y=1","Evento Y=0")
rownames(df) <- c("x=1","x=0")

# genearar tablas
knitr::kable(df, format = "markdown")
```
]

.pull-left[

- **Probabilidades**: La razón se incluye en el denominador

.center[
$\frac{p}{1}$
]
.center[
$\frac{a}{a+c}$
]

- **Chances/momios**: 

.center[
$\frac{p }{1-p}$
]
.center[
$\frac{a}{c}$
]
.center[
$\frac{\text{n de éxitos}}{\text{n de fracasos}}$
]
]
.pull-right[
- **Odds Ratio**: Las chances de producirse el resultado esperado (outcome) en expuestos a una VI, en relación a las chances de experimentar el mismo resultado en no expuestos a una VI.

.center[
$OR = \frac{a \times d}{b \times c} = \frac{\frac{a}{c}}{\frac{b}{d}}$
]
.center[
$P(E) = \frac{O(E)}{O(E)+1}= \frac{\frac{a}{c}}{\frac{a}{c}+1}$
]

- **Razón de prevalencia (PR)**: Razón de proporciones

.center[

$PR = \frac{P_A(E)}{P_B(E)} = \frac{\frac{a}{a+c}}{\frac{b}{b+d}}$

]

.small[
Sea $P_A(E)$ la probabilidad de que se constate/presente la enfermedad en la condición A
]
]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_

- En general, el OR se desviará mucho del RR (Razón de proporciones), si la incidencia del resultados en no-expuestos excede el 10% (el resultado es común), y si el OR es mayor a 2,0 o menor a 0,5.
- **Razón de prevalencia**: similar a la "razón de riesgos" pero aplicado a estudios transversales
- A medida que las probabilidades aumentan, los odds tienden al infinito

---
## Correlación

- **Correlación lineal** : Mide la fuerza de una relación lineal entre dos variables

$$r_{xy} = \frac{\sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y}) } {(n-1)s_x s_y }$$
.pull-left[

.details-code[
```{r echo=T, fig.align='center', fig.retina=1, message=FALSE, warning=FALSE, fig.cap= "Crímenes violentos por Estado en Estados Unidos en 1973", out.width='70%', results='hold', warning=F, message=F}
library(ggplot2)
ggplot(USArrests, aes(Murder, Rape))+ #incluimos las 2 variables, una en el eje x y el otro en Y
  geom_point()+# esoecificamos os puntos
  #######  ocupar una regresión no lineal para ver la relación
  geom_smooth(span = 0.8)+
  #######  utilizamos un tema que simplifique los colores del plot
  theme_bw()+
  #######  especificamos las etiqueta
  ylab("Arrestos por violación (rape) por 100,000 hab")+
  xlab("Arrestos por asesinato (murder) por 100,000 hab")

```
]


.details[

.details-code[

```{r echo=T, fig.retina = 1, fig.align='center', results='hold', warning=F, message=F, fig.show = "hold", out.height="80%"}
#, out.width = "50%"
#par(mar = c(3.8, 3.8, .2, .2))
par(mfrow=c(1,2))
require(car)
####### Para cada columna del vector que contiene los valores
####### segunda_ola y primera_ola
for (k in c("Murder","Rape")) {
###### Comparamos la distribución de los datos asumiendo una distribución teorica normal
         car::qqPlot(USArrests[[k]], col = "skyblue4",  main = paste("Arrestos USA:",k),xlab="Cuartiles Teóricos", ylab="Cuartiles Empíricos",id=F, col.lines="orange")
}
```
]

]

]

.pull-right[

.details[

.details-code[

```{r echo=T, out.width = '70%', fig.retina = 1, fig.align='center', results='hold', warning=F, message=F}
cor.test(USArrests$Murder,USArrests$Rape)
cor.test(USArrests$Murder,USArrests$Rape,method="spearman")
cor.test(USArrests$Murder,USArrests$Rape,method="spearman", exact=FALSE)
## Aproxima el valor p
## También el kendall-tau maneja discrepancias(tau), recomendada cuando hay empates
cor.test(USArrests$Murder,USArrests$Murder,method="kendall")
```

]

]

.center[

[correlación no implica causalidad (si no vea aquí)](https://magnet.xataka.com/un-mundo-fascinante/a-margarina-divorcios-11-divertidos-ejemplos-que-correlacion-no-implica-causalidad)

]

]

???
*#_#_#_#_#_#_#_#_#_#_
**NOTA**
*#_#_#_#_#_#_#_#_#_#_
 - Diagrama de dispersión (scatterplot): es una gráfica de todos los pares ordenados de datos bivariados en un sistema de ejes de coordenadas. La variable de entrada, x, se localiza en el eje horizontal, y la variable de salida, y, se localiza en el eje vertical.

los valores y, en todo el eje vertical, sea igual o ligeramente 
más corto que el rango de los valores x en todo el eje horizontal.
Eje horizontal X, VI; Eje vertical Y, VD.


- relaciones lineales bivariadas 
  - 0 < r < 1 y r →1 relación lineal positiva y fuerte. 
  - 0 < r < 1 y r → 0 relación lineal positiva y débil. 
  - r = 0 no existe relación lineal. 
  - −1 < r < 0 y r → −1 relación lineal negativa y fuerte. 
  - −1 < r < 0 y r → 0 relación lineal negativa y débil. 

---
## Fuentes

- Aron, A. & Aron, E. (2002). Estadística Para Psicología. Brasil. Prentice-Hall.

- Ayçaguer, L. (1997). Cultura Estadística e Investigación Científica en el Campo de la Salud: Una Mirada Crítica. Díaz de Santos.

- Glen, S. (s.f). "Bivariate Analysis Definition & Example" From StatisticsHowTo.com: Elementary Statistics for the rest of us! https://www.statisticshowto.com/bivariate-analysis/

- Johnson, R. & Kuby, P. (2008). Estadística Elemental: lo esencial México: Cengage Learning.

- Montero-Alonso, M.A. (2007, Mayo). Apuntes de Estadística II. Tema 4. Universidad de Granada. Obtenido el 19 de Octubre de 2021 desde: https://www.ugr.es/~eues/webgrupo/Docencia/MonteroAlonso/estadisticaII/tema4.pdf. ISBN: 9788469056639

- Ritchey, F. (2008). Estadística para las Ciencias Sociales. México: McGrawll Hill.

- Ritchie, H. & Roser, M. (2020). "Energy". Publicado en línea en OurWorldInData.org. Obtenido el 16 de Octubre de 2021 desde: 'https://ourworldindata.org/energy' [Recurso en-línea]

- s.a. Datos de países, Índices de Precios de Consumo (IPC). Datosmacro. Obtenido el 16 de Octubre de 2021 desde: https://datosmacro.expansion.com/ipc-paises

- Sandilands D. (2014) Bivariate Analysis. En: Michalos A.C. (eds) Encyclopedia of Quality of Life and Well-Being Research. Springer, Dordrecht. https://doi.org/10.1007/978-94-007-0753-5_222

- Santibáñez, J. (2021). Conceptos básicos de la inferencia estadística. [Material de clases].Unidad 1. Introducción. Javier Santibáñez. IIMAS, UNAM jsantibanez@sigma.iimas.unam.mx. Semestre 2020-1. Obtenido el 18 de Octubre de 2021 desde: http://sigma.iimas.unam.mx/jsantibanez/Cursos/Inferencia/2020_1/notas/u1.pdf

- Starmer, J. "Hypothesis testing and the null hypothesis, clearly explained!!!". Youtube. Obtenido el 17 de Octubre de 2021 desde: https://youtu.be/0oc49DyA3hU



```{r exp, eval=F,echo=F, results="asis"}
library(pagedown)
gsub(".Rmd",".html",rstudioapi::getSourceEditorContext()$path)
#para exportar la presentación a PDF
xaringanBuilder::build_pdf(gsub(".Rmd",".html",rstudioapi::getSourceEditorContext()$path),complex_slides = TRUE,output_file="Clase6.pdf")
```
